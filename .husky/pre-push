#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

echo "ğŸ” Pre-push: validando proyecto (types, lint, build ligero, CSP)."

# 1. Type check
echo "â–¶ Type check"
npm run type-check || { echo "âŒ Type errors"; exit 1; }

# 2. Lint (sin autofix):
echo "â–¶ Lint"
npm run lint || { echo "âŒ Lint errors"; exit 1; }

# 3. Build (asegura que producciÃ³n compila)
echo "â–¶ Build"
npm run build >/dev/null 2>&1 || { echo "âŒ Build failed"; exit 1; }

# 4. Validar CSP mÃ­nima (font-src incluye data:)
echo "â–¶ CSP check"
grep -q "font-src 'self' https://fonts.gstatic.com data:" netlify.toml || { echo "âŒ CSP font-src sin data:"; exit 1; }

echo "âœ… Pre-push passed. Listo para subir."